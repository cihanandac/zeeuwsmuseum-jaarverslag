{"version":3,"file":"vendors~plone-volto-components-manage-Widgets-DatetimeWidget~plone-volto-components-manage-Widgets-R~a875f490.js","sources":["webpack:///./node_modules/@plone/volto/src/components/manage/Widgets/DatetimeWidget.jsx","webpack:///./node_modules/rc-time-picker/assets/index.css"],"sourcesContent":["/**\n * DatetimeWidget component.\n * @module components/manage/Widgets/DatetimeWidget\n */\nimport React, { Component } from 'react';\nimport { compose } from 'redux';\nimport PropTypes from 'prop-types';\nimport { defineMessages, injectIntl } from 'react-intl';\nimport { connect } from 'react-redux';\nimport loadable from '@loadable/component';\nimport cx from 'classnames';\nimport { Icon, FormFieldWrapper } from '@plone/volto/components';\nimport { parseDateTime } from '@plone/volto/helpers';\nimport { injectLazyLibs } from '@plone/volto/helpers/Loadable/Loadable';\n\nimport leftKey from '@plone/volto/icons/left-key.svg';\nimport rightKey from '@plone/volto/icons/right-key.svg';\nimport clearSVG from '@plone/volto/icons/clear.svg';\n\nimport 'rc-time-picker/assets/index.css';\nimport 'react-dates/initialize';\nimport 'react-dates/lib/css/_datepicker.css';\n\nconst TimePicker = loadable(() => import('rc-time-picker'));\n\nconst messages = defineMessages({\n  date: {\n    id: 'Date',\n    defaultMessage: 'Date',\n  },\n  time: {\n    id: 'Time',\n    defaultMessage: 'Time',\n  },\n});\n\nconst PrevIcon = () => (\n  <div\n    style={{\n      color: '#000',\n      left: '22px',\n      padding: '5px',\n      position: 'absolute',\n      top: '15px',\n    }}\n    // eslint-disable-next-line jsx-a11y/no-noninteractive-tabindex\n    tabIndex=\"0\"\n  >\n    <Icon name={leftKey} size=\"30px\" />\n  </div>\n);\nconst NextIcon = () => (\n  <div\n    style={{\n      color: '#000',\n      right: '22px',\n      padding: '5px',\n      position: 'absolute',\n      top: '15px',\n    }}\n    // eslint-disable-next-line jsx-a11y/no-noninteractive-tabindex\n    tabIndex=\"0\"\n  >\n    <Icon name={rightKey} size=\"30px\" />\n  </div>\n);\n\nconst defaultTimeDateOnly = {\n  hour: 12,\n  minute: 0,\n  second: 0,\n};\n\n/**\n * DatetimeWidget component class\n * @class DatetimeWidget\n * @extends Component\n *\n * To use it, in schema properties, declare a field like:\n *\n * ```jsx\n * {\n *  title: \"Publish date\",\n *  type: 'datetime',\n * }\n * ```\n */\nexport class DatetimeWidgetComponent extends Component {\n  /**\n   * Constructor\n   * @method constructor\n   * @param {Object} props Component properties\n   * @constructs DatetimeWidget\n   */\n  constructor(props) {\n    super(props);\n    this.moment = props.moment.default;\n\n    this.state = {\n      focused: false,\n      // if passed value matches the construction time, we guess it's a default\n      isDefault:\n        parseDateTime(\n          this.props.lang,\n          this.props.value,\n          undefined,\n          this.moment,\n        )?.toISOString() === this.moment().utc().toISOString(),\n    };\n  }\n\n  getInternalValue() {\n    return parseDateTime(\n      this.props.lang,\n      this.props.value,\n      undefined,\n      this.moment,\n    );\n  }\n\n  getDateOnly() {\n    return this.props.dateOnly || this.props.widget === 'date';\n  }\n\n  /**\n   * Update date storage\n   * @method onDateChange\n   * @param {Object} date updated momentjs Object for date\n   * @returns {undefined}\n   */\n  onDateChange = (date) => {\n    if (date) {\n      const moment = this.props.moment.default;\n      const isDateOnly = this.getDateOnly();\n      const base = (this.getInternalValue() || moment()).set({\n        year: date.year(),\n        month: date.month(),\n        date: date.date(),\n        ...(isDateOnly ? defaultTimeDateOnly : {}),\n      });\n      const dateValue = isDateOnly\n        ? base.format('YYYY-MM-DD')\n        : base.toISOString();\n      this.props.onChange(this.props.id, dateValue);\n    }\n    this.setState({ isDefault: false });\n  };\n\n  /**\n   * Update date storage\n   * @method onTimeChange\n   * @param {Object} time updated momentjs Object for time\n   * @returns {undefined}\n   */\n  onTimeChange = (time) => {\n    const moment = this.props.moment.default;\n    if (time) {\n      const base = (this.getInternalValue() || moment()).set({\n        hours: time?.hours() ?? 0,\n        minutes: time?.minutes() ?? 0,\n        seconds: 0,\n      });\n      const dateValue = base.toISOString();\n      this.props.onChange(this.props.id, dateValue);\n    }\n  };\n\n  onResetDates = () => {\n    this.setState({ isDefault: false });\n    this.props.onChange(this.props.id, null);\n  };\n\n  /**\n   * Handle SingleDatePicker focus\n   * @method onFocusChange\n   * @param {boolean} focused component focus state.\n   * @returns {undefined}\n   */\n  onFocusChange = ({ focused }) => this.setState({ focused });\n\n  render() {\n    const {\n      id,\n      resettable,\n      intl,\n      reactDates,\n      widgetOptions,\n      lang,\n    } = this.props;\n    const noPastDates =\n      this.props.noPastDates || widgetOptions?.pattern_options?.noPastDates;\n    const moment = this.props.moment.default;\n    const datetime = this.getInternalValue();\n    const dateOnly = this.getDateOnly();\n    const { SingleDatePicker } = reactDates;\n\n    return (\n      <FormFieldWrapper {...this.props}>\n        <div className=\"date-time-widget-wrapper\">\n          <div\n            className={cx('ui input date-input', {\n              'default-date': this.state.isDefault,\n            })}\n          >\n            <SingleDatePicker\n              date={datetime}\n              disabled={this.props.isDisabled}\n              onDateChange={this.onDateChange}\n              focused={this.state.focused}\n              numberOfMonths={1}\n              {...(noPastDates ? {} : { isOutsideRange: () => false })}\n              onFocusChange={this.onFocusChange}\n              noBorder\n              displayFormat={moment.localeData(lang).longDateFormat('L')}\n              navPrev={<PrevIcon />}\n              navNext={<NextIcon />}\n              id={`${id}-date`}\n              placeholder={intl.formatMessage(messages.date)}\n            />\n          </div>\n          {!dateOnly && (\n            <div\n              className={cx('ui input time-input', {\n                'default-date': this.state.isDefault,\n              })}\n            >\n              <TimePicker\n                disabled={this.props.isDisabled}\n                defaultValue={datetime}\n                value={datetime}\n                onChange={this.onTimeChange}\n                allowEmpty={false}\n                showSecond={false}\n                use12Hours={lang === 'en'}\n                id={`${id}-time`}\n                format={moment.localeData(lang).longDateFormat('LT')}\n                placeholder={intl.formatMessage(messages.time)}\n                focusOnOpen\n                placement=\"bottomRight\"\n              />\n            </div>\n          )}\n          {resettable && (\n            <button\n              disabled={this.props.isDisabled || !datetime}\n              onClick={() => this.onResetDates()}\n              className=\"item ui noborder button\"\n            >\n              <Icon name={clearSVG} size=\"24px\" className=\"close\" />\n            </button>\n          )}\n        </div>\n      </FormFieldWrapper>\n    );\n  }\n}\n\n/**\n * Property types.\n * @property {Object} propTypes Property types.\n * @static\n */\nDatetimeWidgetComponent.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  required: PropTypes.bool,\n  error: PropTypes.arrayOf(PropTypes.string),\n  dateOnly: PropTypes.bool,\n  noPastDates: PropTypes.bool,\n  value: PropTypes.string,\n  onChange: PropTypes.func.isRequired,\n  wrapped: PropTypes.bool,\n  resettable: PropTypes.bool,\n};\n\n/**\n * Default properties.\n * @property {Object} defaultProps Default properties.\n * @static\n */\nDatetimeWidgetComponent.defaultProps = {\n  description: null,\n  required: false,\n  error: [],\n  dateOnly: false,\n  noPastDates: false,\n  value: null,\n  resettable: true,\n};\n\nexport default compose(\n  injectLazyLibs(['reactDates', 'moment']),\n  connect((state) => ({\n    lang: state.intl.locale,\n  })),\n  injectIntl,\n)(DatetimeWidgetComponent);\n","// Exports\nmodule.exports = {};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAEA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AALA;AACA;AAUA;AAEA;AACA;AACA;AACA;AACA;AACA;AALA;AADA;AASA;AATA;AAWA;AAAA;AAAA;AAXA;AACA;AAaA;AAEA;AACA;AACA;AACA;AACA;AACA;AALA;AADA;AASA;AATA;AAWA;AAAA;AAAA;AAXA;AACA;AAcA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAFA;AAqCA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAMA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AArDA;AA6DA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AAxEA;AA0EA;AAAA;AAAA;AACA;AACA;AACA;AA7EA;AAoFA;AAAA;AAAA;AAAA;AACA;AAnFA;AAEA;AACA;AACA;AACA;AAHA;AAWA;AACA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAiDA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAEA;AACA;AADA;AADA;AAMA;AACA;AACA;AACA;AACA;AALA;AAMA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AALA;AAuBA;AACA;AADA;AADA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AALA;AAuBA;AACA;AACA;AAHA;AAKA;AAAA;AAAA;AAAA;AALA;AA7CA;AADA;AAyDA;AACA;AAxKA;AA0KA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAcA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AAGA;AADA;;;;;;;;;;;ACrSA;AACA;;;;;A","sourceRoot":""}