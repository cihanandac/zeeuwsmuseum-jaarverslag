{"version":3,"file":"server.e1f99fccf082aff21964.hot-update.js","sources":["webpack:///./src/customizations/components/theme/App/App.jsx"],"sourcesContent":["/**\n * App container.\n * @module components/theme/App/App\n */\n\nimport { Component } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { asyncConnect, Helmet } from '@plone/volto/helpers';\nimport { Segment } from 'semantic-ui-react';\nimport { renderRoutes } from 'react-router-config';\nimport { Slide, ToastContainer, toast } from 'react-toastify';\nimport split from 'lodash/split';\nimport join from 'lodash/join';\nimport trim from 'lodash/trim';\nimport cx from 'classnames';\nimport config from '@plone/volto/registry';\nimport { PluggablesProvider } from '@plone/volto/components/manage/Pluggable';\nimport { visitBlocks } from '@plone/volto/helpers/Blocks/Blocks';\nimport { injectIntl } from 'react-intl';\n\nimport Error from '@plone/volto/error';\n\nimport {\n  Breadcrumbs,\n  Footer,\n  Header,\n  Icon,\n  OutdatedBrowser,\n  AppExtras,\n  SkipLinks,\n} from '@plone/volto/components';\nimport { BodyClass, getBaseUrl, getView, isCmsUi } from '@plone/volto/helpers';\nimport {\n  getBreadcrumbs,\n  getContent,\n  getNavigation,\n  getTypes,\n  getWorkflow,\n} from '@plone/volto/actions';\n\nimport clearSVG from '@plone/volto/icons/clear.svg';\nimport MultilingualRedirector from '@plone/volto/components/theme/MultilingualRedirector/MultilingualRedirector';\nimport WorkingCopyToastsFactory from '@plone/volto/components/manage/WorkingCopyToastsFactory/WorkingCopyToastsFactory';\nimport LockingToastsFactory from '@plone/volto/components/manage/LockingToastsFactory/LockingToastsFactory';\n\nimport * as Sentry from '@sentry/browser';\n\n/**\n * @export\n * @class App\n * @extends {Component}\n */\nclass App extends Component {\n  /**\n   * Property types.\n   * @property {Object} propTypes Property types.\n   * @static\n   */\n  static propTypes = {\n    pathname: PropTypes.string.isRequired,\n    pagetype: PropTypes.string.isRequired,\n  };\n\n  state = {\n    hasError: false,\n    error: null,\n    errorInfo: null,\n  };\n\n  /**\n   * @method componentWillReceiveProps\n   * @param {Object} nextProps Next properties\n   * @returns {undefined}\n   */\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (nextProps.pathname !== this.props.pathname) {\n      if (this.state.hasError) {\n        this.setState({ hasError: false });\n      }\n    }\n  }\n\n  /**\n   * ComponentDidCatch\n   * @method ComponentDidCatch\n   * @param {string} error  The error\n   * @param {string} info The info\n   * @returns {undefined}\n   */\n  componentDidCatch(error, info) {\n    this.setState({ hasError: true, error, errorInfo: info });\n    if (__CLIENT__) {\n      if (window?.env?.RAZZLE_SENTRY_DSN || __SENTRY__?.SENTRY_DSN) {\n        Sentry.captureException(error);\n      }\n    }\n  }\n\n  // {pagetype == \"Jaarverslag Folder\" ? console.log(\"yes\"): console.log(\"no\")};\n\n  // This is for choosing the page type and make the footer disappear\n  // {document.getElementById('field-Page_Type').childNodes[1].children[0].children[0].children[0].firstChild.wholeText === 'Jaarverslag Folder' ? \"yes\" : \"no\"}\n  // document.getElementById('field-Page_Type').childNodes[1].children[0].children[0].children[0].firstChild.wholeText\n  // (document.getElementById('footer').className = 'invisibleFooter') : (document.getElementById('footer').className = 'visibleFooter');\n\n  /**\n   * Render method.\n   * @method render\n   * @returns {string} Markup for the component.\n   */\n  render() {\n    const { views } = config;\n    const path = getBaseUrl(this.props.pathname);\n    const action = getView(this.props.pathname);\n    const isCmsUI = isCmsUi(this.props.pathname);\n    const ConnectionRefusedView = views.errorViews.ECONNREFUSED;\n\n    const pagetype = () => {\n      try {\n        return document.getElementById('field-Page_Type').childNodes[1]\n          .children[0].children[0].children[0].firstChild.wholeText;\n      } catch (e) {\n        return 'visibleFooter';\n      }\n    };\n\n\n\n    return (\n      <PluggablesProvider>\n        {/* {language && (\n          <Helmet>\n            <html lang={language} />\n          </Helmet>\n        )} */}\n        <BodyClass className={`view-${action}view`} />\n        {/* Body class depending on content type */}\n        {this.props.content && this.props.content['@type'] && (\n          <BodyClass\n            className={`contenttype-${this.props.content['@type']\n              .replace(' ', '-')\n              .toLowerCase()}`}\n          />\n        )}\n        {/* Body class depending on sections */}\n        <BodyClass\n          className={cx({\n            [trim(join(split(this.props.pathname, '/'), ' section-'))]:\n              this.props.pathname !== '/',\n            siteroot: this.props.pathname === '/',\n            'is-authenticated': !!this.props.token,\n            'is-anonymous': !this.props.token,\n            'cms-ui': isCmsUI,\n            'public-ui': !isCmsUI,\n          })}\n        />\n        <SkipLinks />\n\n        <Header pathname={path} />\n        {/* <Breadcrumbs pathname={path} /> */}\n\n        <MultilingualRedirector\n          pathname={this.props.pathname}\n          contentLanguage={this.props.content?.language?.token}\n        >\n          <Segment basic className=\"content-area\">\n            <main>\n              <OutdatedBrowser />\n              {this.props.connectionRefused ? (\n                <ConnectionRefusedView />\n              ) : this.state.hasError ? (\n                <Error\n                  message={this.state.error.message}\n                  stackTrace={this.state.errorInfo.componentStack}\n                />\n              ) : (\n                renderRoutes(this.props.route.routes, {\n                  staticContext: this.props.staticContext,\n                })\n              )}\n            </main>\n          </Segment>\n        </MultilingualRedirector>\n\n        <Footer />\n        <LockingToastsFactory\n          content={this.props.content}\n          user={this.props.userId}\n        />\n        <WorkingCopyToastsFactory content={this.props.content} />\n        <ToastContainer\n          position={toast.POSITION.BOTTOM_CENTER}\n          hideProgressBar\n          transition={Slide}\n          autoClose={5000}\n          closeButton={\n            <Icon\n              className=\"toast-dismiss-action\"\n              name={clearSVG}\n              size=\"18px\"\n            />\n          }\n        />\n        <AppExtras {...this.props} />\n            \n      {console.log()};\n      </PluggablesProvider>\n    );\n  }\n}\n\nexport const __test__ = connect(\n  (state, props) => ({\n    pathname: props.location.pathname,\n    token: state.userSession.token,\n    content: state.content.data,\n    apiError: state.apierror.error,\n    connectionRefused: state.apierror.connectionRefused,\n  }),\n  {},\n)(App);\n\nexport const fetchContent = async ({ store, location }) => {\n  const content = await store.dispatch(\n    getContent(getBaseUrl(location.pathname)),\n  );\n\n  const promises = [];\n  const { blocksConfig } = config.blocks;\n\n  const visitor = ([id, data]) => {\n    const blockType = data['@type'];\n    const { getAsyncData } = blocksConfig[blockType];\n    if (getAsyncData) {\n      const p = getAsyncData({\n        store,\n        dispatch: store.dispatch,\n        path: location.pathname,\n        location,\n        id,\n        data,\n      });\n      if (!p?.length) {\n        throw new Error(\n          'You should return a list of promises from getAsyncData',\n        );\n      }\n      promises.push(...p);\n    }\n  };\n\n  visitBlocks(content, visitor);\n\n  await Promise.allSettled(promises);\n\n  return content;\n};\n\nexport default compose(\n  asyncConnect([\n    {\n      key: 'breadcrumbs',\n      promise: ({ location, store: { dispatch } }) =>\n        __SERVER__ && dispatch(getBreadcrumbs(getBaseUrl(location.pathname))),\n    },\n    {\n      key: 'content',\n      promise: ({ location, store }) =>\n        __SERVER__ && fetchContent({ store, location }),\n    },\n    {\n      key: 'navigation',\n      promise: ({ location, store: { dispatch } }) =>\n        __SERVER__ &&\n        dispatch(\n          getNavigation(\n            getBaseUrl(location.pathname),\n            config.settings.navDepth,\n          ),\n        ),\n    },\n    {\n      key: 'types',\n      promise: ({ location, store: { dispatch } }) =>\n        __SERVER__ && dispatch(getTypes(getBaseUrl(location.pathname))),\n    },\n    {\n      key: 'workflow',\n      promise: ({ location, store: { dispatch } }) =>\n        __SERVER__ && dispatch(getWorkflow(getBaseUrl(location.pathname))),\n    },\n  ]),\n  injectIntl,\n  connect(\n    (state, props) => ({\n      pathname: props.location.pathname,\n      token: state.userSession.token,\n      userId: state.userSession.token\n        ? jwtDecode(state.userSession.token).sub\n        : '',\n      content: state.content.data,\n      apiError: state.apierror.error,\n      connectionRefused: state.apierror.connectionRefused,\n    }),\n    null,\n  ),\n)(App);\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AASA;AACA;AAQA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;AAAA;AAAA;AAAA;AACA;AADA;AAYA;AACA;AACA;AAHA;AAXA;AACA;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA,uDAIA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AAMA;AAAA;AAIA;AADA;AAQA;AACA;AAEA;AACA;AACA;AACA;AACA;AAPA;AADA;AAaA;AAAA;AAIA;AACA;AAFA;AAIA;AAAA;AAAA;AACA;AAMA;AACA;AAFA;AAMA;AADA;AAVA;AADA;AAJA;AAyBA;AACA;AAFA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAHA;AANA;AA7DA;AA+EA;AACA;AA7JA;AACA;AADA;AAOA;AACA;AAFA;AACA;AAwJA;AAEA;AACA;AACA;AACA;AACA;AALA;AAUA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AAOA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAMA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAHA;AAMA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAYA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAMA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AASA;AACA;AACA;AAGA;AACA;AACA;AARA;;;;A","sourceRoot":""}