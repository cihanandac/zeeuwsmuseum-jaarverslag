{"version":3,"file":"server.5c8cb2266afce4e16210.hot-update.js","sources":["webpack:///./node_modules/@plone/volto/src/components/manage/LockingToastsFactory/LockingToastsFactory.jsx","webpack:///./node_modules/@plone/volto/src/components/manage/WorkingCopyToastsFactory/WorkingCopyToastsFactory.jsx","webpack:///./node_modules/@plone/volto/src/components/theme/MultilingualRedirector/MultilingualRedirector.jsx","webpack:///./src/customizations/components/theme/App/App.jsx","webpack:///external \"@sentry/browser\"","webpack:///external \"lodash/trim\""],"sourcesContent":["import React from 'react';\n// import { Link } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { useSelector } from 'react-redux';\nimport { useLocation } from 'react-router-dom';\nimport { defineMessages, useIntl } from 'react-intl';\nimport { Toast } from '@plone/volto/components';\n// import { flattenToAppURL } from '@plone/volto/helpers';\nimport { parse } from 'date-fns';\nimport useDeepCompareEffect from 'use-deep-compare-effect';\n\nconst messages = defineMessages({\n  thisItemIsLocked: {\n    id: 'This item was locked by {creator} on {date}',\n    defaultMessage: 'This item was locked by {creator} on {date}',\n  },\n  unlockItem: {\n    id:\n      'If you are certain this user has abandoned the object, you may unlock the object. You will then be able to edit it.',\n    defaultMessage:\n      'If you are certain this user has abandoned the object, you may unlock the object. You will then be able to edit it.',\n  },\n});\n\nconst LockingToastsFactory = (props) => {\n  const intl = useIntl();\n  const pathname = useLocation().pathname;\n  const lang = useSelector((state) => state.intl.locale);\n  const { content, user } = props;\n  const lock = content?.lock;\n  const creator = lock?.creator_name || lock?.creator || '';\n  // const creator_url = locking?.creator_url || '';\n  const date = lock?.created || '';\n  const dateOptions = {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n    hour: 'numeric',\n    minute: 'numeric',\n  };\n\n  useDeepCompareEffect(() => {\n    if (user && content) {\n      if (lock?.locked && lock?.stealable && lock?.creator !== user) {\n        if (toast.isActive('lockinginfo')) {\n          toast.update('lockinginfo', {\n            render: (\n              <Toast\n                info\n                title={intl.formatMessage(messages.thisItemIsLocked, {\n                  creator: creator,\n                  date: new Intl.DateTimeFormat(lang, dateOptions).format(\n                    parse(date),\n                  ),\n                })}\n                content={intl.formatMessage(messages.unlockItem, {})}\n              />\n            ),\n          });\n        } else {\n          toast.info(\n            <Toast\n              info\n              title={intl.formatMessage(messages.thisItemIsLocked, {\n                creator: creator,\n                date: new Intl.DateTimeFormat(lang, dateOptions).format(\n                  parse(date),\n                ),\n              })}\n              content={intl.formatMessage(messages.unlockItem, {})}\n            />,\n            {\n              toastId: 'lockinginfo',\n              autoClose: false,\n              closeButton: false,\n              transition: null,\n            },\n          );\n        }\n      } else {\n        if (toast.isActive('lockinginfo')) {\n          toast.dismiss('lockinginfo');\n        }\n      }\n    }\n  }, [content, creator, date, dateOptions, intl, lang, lock, pathname, user]);\n\n  return null;\n};\n\nexport default LockingToastsFactory;\n","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { useSelector } from 'react-redux';\nimport { useLocation } from 'react-router-dom';\nimport { defineMessages, useIntl } from 'react-intl';\nimport { Toast } from '@plone/volto/components';\nimport { flattenToAppURL } from '@plone/volto/helpers';\nimport { parse } from 'date-fns';\nimport config from '@plone/volto/registry';\nimport useDeepCompareEffect from 'use-deep-compare-effect';\n\nconst messages = defineMessages({\n  thisIsAWorkingCopyOf: {\n    id: 'This is a working copy of {title}',\n    defaultMessage: 'This is a working copy of {title}',\n  },\n  workingCopyIs: {\n    id: 'This has an ongoing working copy in {title}',\n    defaultMessage: 'This has an ongoing working copy in {title}',\n  },\n  workingCopyCreatedBy: {\n    id: 'Created by {creator} on {date}',\n    defaultMessage: 'Created by {creator} on {date}',\n  },\n});\n\nconst WorkingCopyToastsFactory = (props) => {\n  const intl = useIntl();\n  const pathname = useLocation().pathname;\n  const lang = useSelector((state) => state.intl.locale);\n  const { content } = props;\n  const title = content?.title;\n  const working_copy = content?.working_copy;\n  const dateOptions = {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  };\n\n  useDeepCompareEffect(() => {\n    if (content && config.settings.hasWorkingCopySupport) {\n      if (working_copy) {\n        let toastMessage, toastTitle;\n        if (content.working_copy_of) {\n          // I'm a working copy\n          toastMessage = messages.thisIsAWorkingCopyOf;\n          toastTitle = (\n            <Link to={flattenToAppURL(content.working_copy_of['@id'])}>\n              {content.working_copy_of?.title}\n            </Link>\n          );\n        } else {\n          // I'm a baseline\n          toastMessage = messages.workingCopyIs;\n          toastTitle = (\n            <Link to={flattenToAppURL(working_copy['@id'])}>\n              {working_copy?.title}\n            </Link>\n          );\n        }\n        if (toast.isActive('workingcopyinfo')) {\n          toast.update('workingcopyinfo', {\n            render: (\n              <Toast\n                info\n                title={intl.formatMessage(toastMessage, {\n                  title: toastTitle,\n                })}\n                content={intl.formatMessage(messages.workingCopyCreatedBy, {\n                  creator: working_copy?.creator_name,\n                  date: new Intl.DateTimeFormat(lang, dateOptions).format(\n                    parse(working_copy?.created),\n                  ),\n                })}\n              />\n            ),\n          });\n        } else {\n          toast.info(\n            <Toast\n              info\n              title={intl.formatMessage(toastMessage, {\n                title: toastTitle,\n              })}\n              content={intl.formatMessage(messages.workingCopyCreatedBy, {\n                creator: working_copy?.creator_name,\n                date: new Intl.DateTimeFormat(lang, dateOptions).format(\n                  parse(working_copy?.created),\n                ),\n              })}\n            />,\n            {\n              toastId: 'workingcopyinfo',\n              autoClose: false,\n              closeButton: false,\n              transition: null,\n            },\n          );\n        }\n      }\n      if (!working_copy) {\n        if (toast.isActive('workingcopyinfo')) {\n          toast.dismiss('workingcopyinfo');\n        }\n      }\n    }\n  }, [pathname, content, title, working_copy, intl, lang, dateOptions]);\n\n  return null;\n};\n\nexport default WorkingCopyToastsFactory;\n","import React from 'react';\nimport { Redirect } from 'react-router-dom';\nimport { useDispatch } from 'react-redux';\nimport { useCookies } from 'react-cookie';\nimport config from '@plone/volto/registry';\nimport { changeLanguage } from '@plone/volto/actions';\nimport { normalizeLanguageName } from '@plone/volto/helpers';\n\nconst MultilingualRedirector = (props) => {\n  const { settings } = config;\n  const { pathname, children } = props;\n  const [cookies] = useCookies();\n  const currentLanguage = cookies['I18N_LANGUAGE'] || settings.defaultLanguage;\n  const redirectToLanguage = settings.supportedLanguages.includes(\n    currentLanguage,\n  )\n    ? currentLanguage\n    : settings.defaultLanguage;\n  const dispatch = useDispatch();\n\n  React.useEffect(() => {\n    // ToDo: Add means to support language negotiation (with config)\n    // const detectedLang = (navigator.language || navigator.userLanguage).substring(0, 2);\n    let mounted = true;\n    if (settings.isMultilingual && pathname === '/') {\n      const langFileName = normalizeLanguageName(redirectToLanguage);\n      import('@root/../locales/' + langFileName + '.json').then((locale) => {\n        if (mounted) {\n          dispatch(changeLanguage(redirectToLanguage, locale.default));\n        }\n      });\n    }\n    return () => {\n      mounted = false;\n    };\n  }, [pathname, dispatch, redirectToLanguage, settings.isMultilingual]);\n\n  return pathname === '/' && settings.isMultilingual ? (\n    <Redirect to={`/${redirectToLanguage}`} />\n  ) : (\n    <>{children}</>\n  );\n};\n\nexport default MultilingualRedirector;\n","/**\n * App container.\n * @module components/theme/App/App\n */\n\nimport { Component } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { asyncConnect, Helmet } from '@plone/volto/helpers';\nimport { Segment } from 'semantic-ui-react';\nimport { renderRoutes } from 'react-router-config';\nimport { Slide, ToastContainer, toast } from 'react-toastify';\nimport split from 'lodash/split';\nimport join from 'lodash/join';\nimport trim from 'lodash/trim';\nimport cx from 'classnames';\nimport config from '@plone/volto/registry';\nimport { PluggablesProvider } from '@plone/volto/components/manage/Pluggable';\nimport { visitBlocks } from '@plone/volto/helpers/Blocks/Blocks';\nimport { injectIntl } from 'react-intl';\n\nimport Error from '@plone/volto/error';\n\nimport {\n  Breadcrumbs,\n  Footer,\n  Header,\n  Icon,\n  OutdatedBrowser,\n  AppExtras,\n  SkipLinks,\n} from '@plone/volto/components';\nimport { BodyClass, getBaseUrl, getView, isCmsUi } from '@plone/volto/helpers';\nimport {\n  getBreadcrumbs,\n  getContent,\n  getNavigation,\n  getTypes,\n  getWorkflow,\n} from '@plone/volto/actions';\n\nimport clearSVG from '@plone/volto/icons/clear.svg';\nimport MultilingualRedirector from '@plone/volto/components/theme/MultilingualRedirector/MultilingualRedirector';\nimport WorkingCopyToastsFactory from '@plone/volto/components/manage/WorkingCopyToastsFactory/WorkingCopyToastsFactory';\nimport LockingToastsFactory from '@plone/volto/components/manage/LockingToastsFactory/LockingToastsFactory';\n\nimport * as Sentry from '@sentry/browser';\n\n/**\n * @export\n * @class App\n * @extends {Component}\n */\nclass App extends Component {\n  /**\n   * Property types.\n   * @property {Object} propTypes Property types.\n   * @static\n   */\n  static propTypes = {\n    pathname: PropTypes.string.isRequired,\n  };\n\n  state = {\n    hasError: false,\n    error: null,\n    errorInfo: null,\n  };\n\n  /**\n   * @method componentWillReceiveProps\n   * @param {Object} nextProps Next properties\n   * @returns {undefined}\n   */\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (nextProps.pathname !== this.props.pathname) {\n      if (this.state.hasError) {\n        this.setState({ hasError: false });\n      }\n    }\n  }\n\n  /**\n   * ComponentDidCatch\n   * @method ComponentDidCatch\n   * @param {string} error  The error\n   * @param {string} info The info\n   * @returns {undefined}\n   */\n  componentDidCatch(error, info) {\n    this.setState({ hasError: true, error, errorInfo: info });\n    if (__CLIENT__) {\n      if (window?.env?.RAZZLE_SENTRY_DSN || __SENTRY__?.SENTRY_DSN) {\n        Sentry.captureException(error);\n      }\n    }\n  }\n\n  /**\n   * Render method.\n   * @method render\n   * @returns {string} Markup for the component.\n   */\n  render() {\n    const { views } = config;\n    const path = getBaseUrl(this.props.pathname);\n    const action = getView(this.props.pathname);\n    const isCmsUI = isCmsUi(this.props.pathname);\n    const ConnectionRefusedView = views.errorViews.ECONNREFUSED;\n\n    // const language =\n    //   this.props.content?.language?.token ?? this.props.intl?.locale;\n\n    return (\n      <PluggablesProvider>\n        {/* {language && (\n          <Helmet>\n            <html lang={language} />\n          </Helmet>\n        )} */}\n        <BodyClass className={`view-${action}view`} />\n        {/* Body class depending on content type */}\n        {this.props.content && this.props.content['@type'] && (\n          <BodyClass\n            className={`contenttype-${this.props.content['@type']\n              .replace(' ', '-')\n              .toLowerCase()}`}\n          />\n        )}\n        {/* Body class depending on sections */}\n        <BodyClass\n          className={\n            (cx({\n              [trim(join(split(this.props.pathname, '/'), ' section-'))]:\n                this.props.pathname !== '/',\n              siteroot: this.props.pathname === '/',\n              'is-authenticated': !!this.props.token,\n              'is-anonymous': !this.props.token,\n              'cms-ui': isCmsUI,\n              'public-ui': !isCmsUI,\n            }),\n            this.props.content.footerinvisible)\n          }\n        />\n        <SkipLinks />\n\n        <Header pathname={path} />\n        {/* <Breadcrumbs pathname={path} /> */}\n\n        <MultilingualRedirector\n          pathname={this.props.pathname}\n          contentLanguage={this.props.content?.language?.token}\n        >\n          <Segment basic className=\"content-area\">\n            <main>\n              <OutdatedBrowser />\n              {this.props.connectionRefused ? (\n                <ConnectionRefusedView />\n              ) : this.state.hasError ? (\n                <Error\n                  message={this.state.error.message}\n                  stackTrace={this.state.errorInfo.componentStack}\n                />\n              ) : (\n                renderRoutes(this.props.route.routes, {\n                  staticContext: this.props.staticContext,\n                })\n              )}\n            </main>\n          </Segment>\n        </MultilingualRedirector>\n\n        {this.props.content.footerinvisible === null ? <Footer /> : ''}\n\n        <LockingToastsFactory\n          content={this.props.content}\n          user={this.props.userId}\n        />\n        <WorkingCopyToastsFactory content={this.props.content} />\n        <ToastContainer\n          position={toast.POSITION.BOTTOM_CENTER}\n          hideProgressBar\n          transition={Slide}\n          autoClose={5000}\n          closeButton={\n            <Icon\n              className=\"toast-dismiss-action\"\n              name={clearSVG}\n              size=\"18px\"\n            />\n          }\n        />\n        <AppExtras {...this.props} />\n      </PluggablesProvider>\n    );\n  }\n}\n\nexport const __test__ = connect(\n  (state, props) => ({\n    pathname: props.location.pathname,\n    token: state.userSession.token,\n    content: state.content.data,\n    apiError: state.apierror.error,\n    connectionRefused: state.apierror.connectionRefused,\n  }),\n  {},\n)(App);\n\nexport const fetchContent = async ({ store, location }) => {\n  const content = await store.dispatch(\n    getContent(getBaseUrl(location.pathname)),\n  );\n\n  const promises = [];\n  const { blocksConfig } = config.blocks;\n\n  const visitor = ([id, data]) => {\n    const blockType = data['@type'];\n    const { getAsyncData } = blocksConfig[blockType];\n    if (getAsyncData) {\n      const p = getAsyncData({\n        store,\n        dispatch: store.dispatch,\n        path: location.pathname,\n        location,\n        id,\n        data,\n      });\n      if (!p?.length) {\n        throw new Error(\n          'You should return a list of promises from getAsyncData',\n        );\n      }\n      promises.push(...p);\n    }\n  };\n\n  visitBlocks(content, visitor);\n\n  await Promise.allSettled(promises);\n\n  return content;\n};\n\nexport default compose(\n  asyncConnect([\n    {\n      key: 'breadcrumbs',\n      promise: ({ location, store: { dispatch } }) =>\n        __SERVER__ && dispatch(getBreadcrumbs(getBaseUrl(location.pathname))),\n    },\n    {\n      key: 'content',\n      promise: ({ location, store }) =>\n        __SERVER__ && fetchContent({ store, location }),\n    },\n    {\n      key: 'navigation',\n      promise: ({ location, store: { dispatch } }) =>\n        __SERVER__ &&\n        dispatch(\n          getNavigation(\n            getBaseUrl(location.pathname),\n            config.settings.navDepth,\n          ),\n        ),\n    },\n    {\n      key: 'types',\n      promise: ({ location, store: { dispatch } }) =>\n        __SERVER__ && dispatch(getTypes(getBaseUrl(location.pathname))),\n    },\n    {\n      key: 'workflow',\n      promise: ({ location, store: { dispatch } }) =>\n        __SERVER__ && dispatch(getWorkflow(getBaseUrl(location.pathname))),\n    },\n  ]),\n  injectIntl,\n  connect(\n    (state, props) => ({\n      pathname: props.location.pathname,\n      token: state.userSession.token,\n      userId: state.userSession.token\n        ? jwtDecode(state.userSession.token).sub\n        : '',\n      content: state.content.data,\n      apiError: state.apierror.error,\n      connectionRefused: state.apierror.connectionRefused,\n    }),\n    null,\n  ),\n)(App);\n","module.exports = require(\"@sentry/browser\");","module.exports = require(\"lodash/trim\");"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AALA;AACA;AAYA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAMA;AARA;AAFA;AAcA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAMA;AARA;AAWA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AATA;AACA;AAcA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AAFA;AALA;AAFA;AAgBA;AACA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AAFA;AALA;AAaA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;AChHA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5CA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AASA;AACA;AAQA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;AAAA;AAAA;AAAA;AACA;AADA;AAWA;AACA;AACA;AAHA;AAVA;AACA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA,uDAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAMA;AAAA;AAIA;AADA;AAQA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAPA;AAFA;AAgBA;AAAA;AAIA;AACA;AAFA;AAIA;AAAA;AAAA;AACA;AAMA;AACA;AAFA;AAMA;AADA;AAVA;AADA;AAJA;AA0BA;AACA;AAFA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAHA;AANA;AAjEA;AAiFA;AACA;AA/IA;AACA;AADA;AAOA;AADA;AACA;AA0IA;AAEA;AACA;AACA;AACA;AACA;AALA;AAUA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AAOA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAMA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAHA;AAMA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAYA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAMA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AASA;AACA;AACA;AAGA;AACA;AACA;AARA;;;;;;;;;;;AC3RA;;;;;;;;;;;ACAA;;;;A","sourceRoot":""}